# CreateItemRequest API Changes

## Summary
Removed auto-generated GUID fields from the CreateItemRequest model to simplify the API contract. These GUIDs are now generated by the backend repository layer where they belong.

## Changes Made

### 1. New Request DTOs Created

#### CreateItemVariantRequest
Location: `Domain/Models/Requests/CreateItemVariantRequest.cs`

Fields removed compared to `ItemVariant`:
- `ItemId` - This is the parent item reference, which is set by the repository when saving

Fields kept:
- `Id` (string) - Frontend identifier, converted to Guid or generated if invalid
- All other variant properties (Price, StockQuantity, Sku, etc.)

#### CreateItemAttributeRequest  
Location: `Domain/Models/Requests/CreateItemAttributeRequest.cs`

Fields removed compared to `ItemAttribute`:
- `Id` - Generated by repository
- `ItemID` - Parent item reference, set by repository

Fields kept:
- `AttributeName_en`, `AttributeName_fr`
- `Attributes_en`, `Attributes_fr`

### 2. Updated CreateItemRequest
Location: `Domain/Models/Requests/CreateItemRequest.cs`

Changed from:
```csharp
public List<ItemVariant> Variants { get; set; } = new();
public List<ItemAttribute> ItemAttributes { get; set; } = new();
```

To:
```csharp
public List<CreateItemVariantRequest> Variants { get; set; } = new();
public List<CreateItemAttributeRequest> ItemAttributes { get; set; } = new();
```

### 3. Updated ItemService Mapping
Location: `Domain/Services/Implementations/ItemService.cs`

The service now maps the request DTOs to domain models:
- Variant `Id` (string) → Parsed to Guid using `Guid.TryParse()`, defaults to `Guid.Empty` if invalid
- Variant `ItemId` → Set to `Guid.Empty`, populated by repository
- ItemAttribute `Id` → Set to `Guid.Empty`, generated by repository  
- ItemAttribute `ItemID` → Set to `Guid.Empty`, populated by repository

### 4. Updated Frontend
Location: `Seller/seller.client/src/components/Seller/ProductsSection.tsx`

Removed fields from request:
- `ItemId` from variants (was `'00000000-0000-0000-0000-000000000000'`)
- `Id` and `ItemID` from ItemAttributes (were `'00000000-0000-0000-0000-000000000000'`)

## API Contract Changes

### Before
```json
{
  "SellerID": "907fe710-58d7-4a64-a7b8-5f1653582dd7",
  "Name_en": "Test",
  "Name_fr": "Test",
  "Description_en": "Desc",
  "Description_fr": "Desc",
  "CategoryID": "ba6c53e1-8fa7-4590-933e-d13edcb32612",
  "Variants": [
    {
      "Id": "variant-1",
      "ItemId": "00000000-0000-0000-0000-000000000000",
      "Price": 20,
      ...
    }
  ],
  "ItemAttributes": [
    {
      "Id": "00000000-0000-0000-0000-000000000000",
      "ItemID": "00000000-0000-0000-0000-000000000000",
      "AttributeName_en": "Material",
      ...
    }
  ]
}
```

### After
```json
{
  "SellerID": "907fe710-58d7-4a64-a7b8-5f1653582dd7",
  "Name_en": "Test",
  "Name_fr": "Test",
  "Description_en": "Desc",
  "Description_fr": "Desc",
  "CategoryID": "ba6c53e1-8fa7-4590-933e-d13edcb32612",
  "Variants": [
    {
      "Id": "variant-1",
      "Price": 20,
      ...
    }
  ],
  "ItemAttributes": [
    {
      "AttributeName_en": "Material",
      ...
    }
  ]
}
```

## Benefits

1. **Cleaner API Contract** - Clients don't need to provide placeholder GUIDs
2. **Better Separation of Concerns** - ID generation is handled by the repository layer
3. **Reduced Confusion** - No ambiguity about who is responsible for ID generation
4. **Type Safety** - Frontend can use string identifiers, backend handles Guid conversion

## Testing

Added comprehensive tests in `API.Tests/ItemServiceShould.cs`:
- `CreateItemAsync_MapsVariantsCorrectly_WhenVariantsProvided` - Verifies variant mapping
- `CreateItemAsync_MapsItemAttributesCorrectly_WhenAttributesProvided` - Verifies attribute mapping

All tests passing (314 total, 6 known unrelated failures).

## Migration Notes

For existing clients:
- Remove `ItemId` field from variant objects in CreateItemRequest
- Remove `Id` and `ItemID` fields from ItemAttributes in CreateItemRequest
- Variant `Id` can still be provided as a string identifier (will be converted to Guid or auto-generated)
